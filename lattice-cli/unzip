#!/usr/bin/env python3
import sys
import zipfile
import os


def main():
    args = sys.argv[1:]
    dest = os.curdir
    zip_path = None

    i = 0
    while i < len(args):
        arg = args[i]
        if arg == "-d" and i + 1 < len(args):
            dest = args[i + 1]
            i += 2
        elif arg.startswith("-"):
            flags = arg[1:]
            if "d" in flags:
                if i + 1 >= len(args):
                    sys.stderr.write("unzip shim error: -d flag missing destination\n")
                    return 1
                dest = args[i + 1]
                i += 2
            else:
                i += 1
        else:
            zip_path = arg
            i += 1

    if not zip_path:
        sys.stderr.write("unzip shim error: missing zip file\n")
        return 1

    try:
        with zipfile.ZipFile(zip_path) as zf:
            zf.extractall(dest)
    except Exception as exc:
        sys.stderr.write(f"unzip shim error: {exc}\n")
        return 1

    return 0


if __name__ == "__main__":
    raise SystemExit(main())
